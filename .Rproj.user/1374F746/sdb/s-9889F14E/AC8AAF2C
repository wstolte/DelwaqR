{
    "contents" : "# source('d:/REPOS-CHECK-OUTS/OpenEarthTools/r/applications/Delft3D/waq/delwaq_his.rpj')\n## model application scenarios\nsource('d:/REPOS-CHECK-OUTS/OpenEarthTools/r/applications/Delft3D/waq/read.his2.r')\n\nscenario1     <- \"eco-scen5-run1-28-y2-day\"\nscenario2     <- \"eco-scen5-run15-28-y2-day\"\nscenario3     <- \"eco-scen5-run45-28-y2-day\"\n\n# scenario1     <- \"eco-scen4-run1-02-min25-y2-day\"\n# scenario4     <- \"eco-scen4-run1-02-min25-nuts20-y2-day\"\n# scenario5     <- \"eco-scen4-run1-02-min25-nuts40-y2-day\"\n\nmoddir<-\"d:/Models/ED/\"\n#Read data ===============================================================================\narr1 <- read.his2(paste(moddir,scenario1,\".his\",sep=\"\"))\narr2 <- read.his2(paste(moddir,scenario2,\".his\",sep=\"\"))\narr3 <- read.his2(paste(moddir,scenario3,\".his\",sep=\"\"))\n# arr4 <- read.his2(paste(moddir,scenario4,\".his\",sep=\"\"))\n# arr5 <- read.his2(paste(moddir,scenario5,\".his\",sep=\"\"))\n\n## Ems-Dollard locations and relevant substances\nlocmod1 = c(\"ED01\",\"ED02\")\nlocmod2 = c(\"Huibertgat_oost\",\"ED01\")\nlocmod3 = c(\"Bocht_van_Watum\",\"Groote_Gat_noord\",\"ED02\")\nlocmod4 = c(\"Huibertgat_oost\",\"Bocht_van_Watum\",\"Groote_Gat_noord\")\nlocmod5 = c(\"IM01\", \"IM02\", \"IM03\",\n            \"IM04\", \"IM05\", \"IM06\",\n            \"IM07\", #\"IM08\", \"IM09\",\n            \"IM10\")\nlocmod = c(locmod5)\n\n# submod=c(\"SS\",\"ExtVl\",\"TotN\",\"TotP\",\"NO3\",\"PO4\",\"Si\",\"Chlfa\",\"OXY\")\nsubmod=c(\"SS\",\"ExtVl\",\"Chlfa\", \"fPPtot\")\n# submod=c(\"MDIATOMS\",\"MFLAGELA\",\"PHAEOCYS\",\"UlvaF\",\"Chlfa\")\nsubmod <- c(\"Depth\", \"RadBot\")\nrequire(ggplot2)\nrequire(scales)\nrequire(reshape2)\nrequire(plyr)\nplotdir <- \"d:/MODELS/ED/plots_scenarios-2015/\"\n\n# make data frames ========================================================================\n#df.BvW.Chla<-data.frame(outputarray[,\"Bocht_van_Watum     \",\"Chlfa               \"])\ndir.create(paste(moddir,\"plots_\",\"scenarios\",sep=\"\"))\n\ndf1<- melt(arr1[,locmod, submod], varnames=c(\"time\", \"location\", \"substance\"))\n  df1$location <- factor(df1$location,levels = locmod)\n  df1$substance <- factor(df1$substance,levels = submod)\n  df1$datetime <- as.POSIXct(x=df1$time)\n  df1$scenario<-as.factor(scenario1)\ndf2 <- melt(arr2[,locmod, submod], varnames=c(\"time\", \"location\", \"substance\"))\n  df2$location <- factor(df2$location,levels = locmod)\n  df2$substance <- factor(df2$substance,levels = submod)\n  df2$datetime <- as.POSIXct(x=df2$time)\n  df2$scenario <- as.factor(scenario2)\ndf3 <- melt(arr3[,locmod, submod], varnames=c(\"time\", \"location\", \"substance\"))\n  df3$location <- factor(df3$location,levels = locmod)\n  df3$substance <- factor(df3$substance,levels = submod)\n  df3$datetime <- as.POSIXct(x=df3$time)\n  df3$scenario <- as.factor(scenario3)\n# df4 <- melt(arr4[,locmod, submod], varnames=c(\"time\", \"location\", \"substance\"))\n#   df4$location <- factor(df4$location,levels = locmod)\n#   df4$substance <- factor(df4$substance,levels = submod)\n#   df4$datetime <- as.POSIXct(x=df4$time)\n#   df4$scenario <- as.factor(scenario4)\n# df5 <- melt(arr5[,locmod, submod], varnames=c(\"time\", \"location\", \"substance\"))\n#   df5$location <- factor(df5$location,levels = locmod)\n#   df5$substance <- factor(df5$substance,levels = submod)\n#   df5$datetime <- as.POSIXct(x=df5$time)\n#   df5$scenario <- as.factor(scenario5)\n\n#### onderscheid maken tussen beide dataframes (rename values)\n#     df<-rbind(rbind(rbind(rbind(df1,df2),df3),df4),df5)\n#      df<-rbind(rbind(rbind(df1,df2),df3),df4)\n   df<-rbind(rbind(df1,df2),df3)\n#     df<-rbind(df1,df2)\n#     df <- df3\n\nmapping   <- read.csv2(\"d:/Tools_Scripts/Mapping tables/RWS2DELWAQ2names.csv\",\n                      , colClasses = \"character\")\ndf$substance     <-  mapvalues(df$substance, mapping$Delwaq, mapping$Delwaq_long_name)\n\ndf$scenario<-mapvalues(df$scenario,\n                              c(scenario1, scenario2, scenario3),\n                              c(\"reference\", \"scenario1\", \"scenario2\"))\n\n\nbeginsummer <- as.POSIXct(\"2012-02-29\")\nendsummer   <- as.POSIXct(\"2012-10-01\")\n#df.summer <- subset(subset(df,datetime >as.POSIXct(\"2012-02-29\")))\ndf.summer <- subset(df,datetime > beginsummer & datetime < endsummer)\ndf.winter <- subset(df,datetime < beginsummer | datetime > endsummer)\n\nq90 <- function(x) {quantile(x,probs=0.9)}\np = ggplot(subset(df.summer, df.summer$substance == \"Chlfa\"), aes(location, value))\np = ggplot(df.summer, aes(scenario, value))\np +\n#   geom_hline(yintercept=18, color = \"orange\", size = 2) +\n  geom_boxplot(notch=T, aes(fill = scenario),outlier.size=0.1) +\n#   geom_jitter(alpha = 0.3, size = 1) +\n  theme(legend.position = \"bottom\",axis.text.x = element_blank(),\n        axis.title = element_blank(),\n        axis.ticks.x = element_blank(),\n        legend.direction = \"horizontal\",\n        legend.title = element_blank(),\n        text = element_text(size = 14)) +\n#   scale_y_log10() +\n  facet_grid(substance ~ location, scales = \"free\") +\n#   stat_summary(fun.y = q90, aes(color = substance), size = 1, geom = \"crossbar\", ymin = -1, ymax = -1) +\n  ylab(\"\")\n\n# dev.off()\nggsave(file=paste(plotdir,\"_boxplot\",\".png\",sep=\"\"),\n       width=10,height=10,dpi=300)\n\n\np = ggplot(df.summer, aes(location, value))\np +\n  #   geom_hline(yintercept=18, color = \"orange\", size = 2) +\n  geom_boxplot(notch=T,\n               aes(fill = location),outlier.size=0.1) +\n  #   geom_jitter(alpha = 0.3, size = 1) +\n  theme(legend.position = \"bottom\",axis.text.x = element_blank(),\n        axis.title = element_blank(),\n        axis.ticks.x = element_blank(),\n        legend.direction = \"horizontal\",\n        legend.title = element_blank(),\n        text = element_text(size = 14)) +\n  #   scale_y_log10() +\n  facet_grid(substance ~scenario, scales = \"free\") +\n  geom_vline(aes(xintercept = 2.5), color = \"white\", size = 2) +\n  #   stat_summary(fun.y = q90, aes(color = substance), size = 1, geom = \"crossbar\", ymin = -1, ymax = -1) +\n  ylab(\"\")\n\ndev.off()\nggsave(file=paste(plotdir,\"_boxplot_areas\",\".png\",sep=\"\"),\n       width=8,height=8,dpi=300)\n\n\nperc90 <- dcast(df.summer,substance + scenario ~ location,\n                function(x) quantile(x,0.9), value.var=\"value\")\nperc90\nsds <- dcast(df.summer,substance + scenario ~ location,\n             sd, value.var=\"value\")\nsds\n\nlibrary(plyr)\nperc90 <- dcast(df.summer, substance + scenario ~ location,\n#                 function(x) quantile(x,0.9),\n                function(x) quantile(x,0.9),\n                subset = .(substance == \"Chlfa\"))\nmperc90 <- melt(perc90)\n\n# qplot(scenario, ED02, data=means, geom = \"point\", color = substance, size = 3)\n\nlibrary(plyr)\ndf$substance<-mapvalues(df$substance,\n                          c(\"MDIATOMS\",\"MFLAGELA\",\"PHAEOCYS\",\"UlvaF\"),\n                          c(\"Diatoms\",\"Flagellates\", \"Phaeocystis\",\"Benthic diatoms\"))\n\n\n\n\n\n  ## Start plotting==========================================================\n     p <- ggplot(df,aes(datetime,value))\np +\n       geom_line(aes(linetype=scenario,color=scenario),size=0.8) +\n      # geom_line(aes(datetime,week),size=0.6,color=\"black\") +\n        scale_x_datetime(labels = date_format(\"%b\"),breaks=date_breaks(\"2 months\")) +\n        xlab(\"\")+ylab(\"Concentration\")+ggtitle(paste()) +\n        theme(axis.text.x=element_text(size=11,angle=0,vjust=-0.01)) +\n        theme(axis.text.y=element_text(size=12))+\n        theme(legend.text=element_text(size=12))+\n        facet_grid(substance~location, scales = \"free\") +\n        theme(legend.position=\"right\") +\n        theme_grey(base_size=12,base_family = \"\")\n\n# dev.off()\n    ggsave(file=paste(plotdir,\"newreferencestudy\",\".png\",sep=\"\"),\n            width=9,height=10,dpi=300)\n\np +\n  geom_line(aes(linetype = location, color=location),size=0.8) +\n  # geom_line(aes(datetime,week),size=0.6,color=\"black\") +\n  scale_x_datetime(labels = date_format(\"%b\"),breaks=date_breaks(\"2 months\")) +\n  xlab(\"\")+ylab(\"Concentration\")+ggtitle(paste()) +\n  theme(axis.text.x=element_text(size=11,angle=0,vjust=-0.01)) +\n  theme(axis.text.y=element_text(size=12))+\n  theme(legend.text=element_text(size=12))+\n  facet_grid(substance~scenario, scales = \"free\") +\n  theme(legend.position=\"right\")\n\nggsave(file=paste(plotdir,\"WD-station-comparison\",\".png\",sep=\"\"),\n       width=8,height=9,dpi=300)\n\n",
    "created" : 1424352392813.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2062029990",
    "id" : "AC8AAF2C",
    "lastKnownWriteTime" : 1424442489,
    "path" : "D:/PROJECTS/SPA-KRW-Eems-Dollard/R-tools/compare-model-versions/Read-and-plotcompare-v3-scenarios_Ems_2012.R",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}