{
    "contents" : "##########################################################################\n##                                                                      ##\n##    script for plotting stacked charts of species                     ##\n##               from Delwaq his file                                   ##\n##              willem.stolte@deltares.nl                               ##\n##                                                                      ##\n##########################################################################\n\n## Read data ===============================================================================\nsetwd(\"d:\\\\MODELS\\\\ED\\\\\")\n# setwd(\"p:/1205711-edspa/2012waq/eco-scen4-run1-02\")\n# modversion <- \"eco-scen4-run1-28-y2_2\"\n# modversion <- \"eco-scen4-run1-random-corr-spm-34_2\"\nmodversion <- \"eco-scen4-run1-28-y2_2_copy\"\n# modversion <- \"eco_2013-run1-28_y2-3_025\"\nplotdir<-file.path(getwd(),\"plots\")\ndir.create(plotdir)\n# Include script for reading binary .his file, returns an array of data including headers.\nsource('d:/REPOS-CHECK-OUTS/OpenEarthTools/r/applications/Delft3D/waq/read.his2.r')\narr <- read.his2(paste(modversion,\"-day.his\",sep=\"\"))\ndf.map <- read.csv2(\"d:/Tools_Scripts/Mapping tables/RWS2DELWAQ2names.csv\", header = T, stringsAsFactors=FALSE)\n\n# plot series function ======================================================================\n\n# plotstacked <- function(unit, locmod, submod) {\n#   require(plyr)\n#   require(reshape2)\n#   require(ggplot2)\n#   require(scales)\n\n#   df.map <- read.csv(\"p:/1205711-edspa/2012waq/metingen/RWS2DELWAQ2names.csv\", header = T, stringsAsFactors=FALSE)\n\nlocname=\"MWTL+\"  ; locmod=c(\"WZ590_ZO_Lauwers_oos\",\"Huibertgat_oost\",\"Bocht_van_Watum\",\"Groote_Gat_noord\"); height = 10\n# locname=\"MWTL\"  ; locmod=c(\"Huibertgat_oost\",\"Bocht_van_Watum\",\"Groote_Gat_noord\"); height = 10\n# locname=\"KRW\"   ; locmod = c(\"ED01\",\"ED02\"); height = 5\n# locname = \"IMARES\" ; locmod = c(\"IM01\",\"IM02\",\"IM03\",\n#                                \"IM04\",\"IM05\",\"IM06\",\n#                                \"IM07\",\"IM08\",\"IM09\",\n#                                \"IM10\")\n# locname = \"IM_benthic\"; locmod = c(\"EDB01area\", \"EDB03area\", \"EDB04area\", \"EDB05area\", \"EDB06area\")\n# locname = \"IM_benthic\"; locmod = c(\"EDB01\", \"EDB03\", \"EDB04\", \"EDB05\", \"EDB06\")\n\n\nfilename<-\"Extinction by type\"\nunit<-\"m-1\"\nsubmod=c(\"ExtVlPhyt\",\"ExtVlOSS\",\"ExtVlBak\", \"ExtVl\", \"ExtVlODS\")\n# plotstacked(unit, locmod, submod)\n# saveseries(plotdir, filename, locname, height)\n\n\n  df.mod <- melt(arr[, locmod, submod], varnames=c(\"time\", \"location\", \"species\"))\n  df.mod$datetime  <- as.POSIXct(x=df.mod$time)\n  df.mod$species   <- mapvalues(as.character(df.mod$species), from = df.map$Delwaq, to = df.map$Delwaq_long_name, warn_missing = F)\n  df.mod$location  <- factor(df.mod$location,levels = locmod)\n  #df.mod$species   <- factor(df.mod$species, levels = submod)\ndf.mod1 <- subset(df.mod, df.mod$species != \"total extinction\")\ndf.mod2 <- subset(df.mod, df.mod$species == \"total extinction\")\n\n  p <- ggplot(df.mod1,aes(x = datetime,y = value))\n  p + geom_area(aes(fill=species)) +\n  geom_line(aes(x = datetime, y = value), data = df.mod2) +\n    facet_grid(location~.) +\n    labs(title=paste(\"Model version: \",modversion),x=\"Date\",y=paste(filename,\" (\",unit,\")\",sep=\"\")) +\n    scale_x_datetime(labels = date_format(\"%b\"),breaks=date_breaks(\"months\")) +\n    theme(text = element_text(size = 14))\n\n\n# }\n\nsaveseries <- function(plotdir, filename, locname, height) {\n  dev.off()\n  ggsave(file=paste(plotdir,\"/\", filename,modversion,\"_\",locname,\"_area\",\".png\",sep=\"\"),\n         width=10,height=height,dpi=300)\n}\n\nlocname=\"MWTL+\"  ; locmod=c(\"WZ590_ZO_Lauwers_oos\",\"Huibertgat_oost\",\"Bocht_van_Watum\",\"Groote_Gat_noord\"); height = 10\n# locname=\"MWTL\"  ; locmod=c(\"Huibertgat_oost\",\"Bocht_van_Watum\",\"Groote_Gat_noord\"); height = 10\n# locname=\"KRW\"   ; locmod = c(\"ED01\",\"ED02\"); height = 5\n# locname = \"IMARES\" ; locmod = c(\"IM01\",\"IM02\",\"IM03\",\n#                                \"IM04\",\"IM05\",\"IM06\",\n#                                \"IM07\",\"IM08\",\"IM09\",\n#                                \"IM10\")\nlocname = \"IM_benthic\"; locmod = c(\"EDB01area\", \"EDB03area\", \"EDB04area\", \"EDB05area\", \"EDB06area\")\n# locname = \"IM_benthic\"; locmod = c(\"EDB01\", \"EDB03\", \"EDB04\", \"EDB05\", \"EDB06\")\n\nfilename <- \"algae species\"\nunit<-\"mg C/l\"\nsubmod=c(\"MDIATOMS\",\"MFLAGELA\",\"PHAEOCYS\")\nplotstacked(unit, locmod, submod)\nsaveseries(plotdir, filename, locname, height)\n\n\nfilename <- \"phosphate species\"\nunit<-\"mg P/l\"\nsubmod<-c(\"AlgP\",\n          \"POP1\",\"POP2\",\"POP3\",\"POP4\",\n          \"DOP\",\"AAP\",\"PO4\")\nplotstacked(unit, locmod, submod)\nsaveseries(plotdir, filename, locname, height)\n\nfilename <- \"carbon species\"\nunit<-\"mg C/l\"\nsubmod<-c( \"Phyt\",\n           \"POC1\",\"POC2\",\"POC3\",\n           \"POC4\",\"DOC\")\nplotstacked(unit, locmod, submod)\nsaveseries(plotdir, filename, locname, height)\n\n#\nfilename <- \"nitrogen species\"\nunit<-\"mg N/l\"\nsubmod<-c(\"AlgN\",\n          \"PON1\",\"PON2\",\"PON3\",\n          \"PON4\",\"DON\",\"NH4\",\n          \"NO3\")\nplotstacked(unit, locmod, submod)\nsaveseries(plotdir, filename, locname, height)\n\nfilename <- \"benthic diatoms\"\nunit <- \"g C/m2\"\nsubmod = c(\"ULVAF_E\",\n         \"ULVAF_P\", \"ULVAF_N\")\nplotstacked(unit, locmod, submod)\nsaveseries(plotdir, filename, locname, height)\n\nfilename<-\"diatomtypes\"\nunit<-\"mg C/l\"\nsubmod=c(\"MDIATOMS_E\",\n         \"MDIATOMS_P\",\"MDIATOMS_N\")\nplotstacked(unit, locmod, submod)\nsaveseries(plotdir, filename, locname, height)\n\nfilename<-\"flagelatetypes\"\nunit<-\"mg C/l\"\nsubmod=c(\"MFLAGELA_E\",\n         \"MFLAGELA_P\",\"MFLAGELA_N\")\nplotstacked(unit, locmod, submod)\nsaveseries(plotdir, filename, locname, height)\n\nfilename<-\"Phaeocystistypes\"\nunit<-\"mg C/l\"\nsubmod=c(\"PHAEOCYS_E\",\n         \"PHAEOCYS_P\",\"PHAEOCYS_N\")\nplotstacked(unit, locmod, submod)\nsaveseries(plotdir, filename, locname, height)\n\nfilename<-\"Extinction by type\"\nunit<-\"m-1\"\nsubmod=c(\"ExtVlPhyt\",\"ExtVlOSS\",\"ExtVlBak\", \"ExtVl\")\nplotstacked(unit, locmod, submod)\nsaveseries(plotdir, filename, locname, height)\n\nfilename<-\"limitation species\"\nunit<-\"0(none) - 1 (full)\"\nsubmod<- c(\"Limit gro\", \"Limit e\", \"Limit nit\", \"Limit pho\", \"Limit sil\")\nplotstacked(unit, locmod, submod)\nsaveseries(plotdir, filename, locname, height)\n\n  ## =======================end===============================================\n",
    "created" : 1424786413068.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1304316602",
    "id" : "9967B01",
    "lastKnownWriteTime" : 1424852270,
    "path" : "D:/PROJECTS/SPA-KRW-Eems-Dollard/R-tools/read-and-plot-his/throwaway___Read-and-plot-his-areastacked-Ems-2012-v3-Report.R",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}