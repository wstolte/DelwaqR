{
    "contents" : "source(\"D:/REPOS-CHECK-OUTS/OpenEarthTools/r/applications/Delft3D/waq/read.his2.R\")\nlibrary(plyr)\nlibrary(reshape2)\nlibrary(ggplot2)\n\n# setwd(\"p:/1205711-edspa/2012waq/eco-scen4-run1-02/\")\nsetwd(file.path(\"d:\",\"MODELS\",\"ED\"))\n#   datadir         <- \"p:/1205711-edspa/2012waq/metingen/\"\ndatadir         <- \"d:/GIS-DATA/Nederland/EemsDoll/IMARES/levering 2014-09-10_6g-Data_naar_Deltares/PocketBox/2012/\"\n\n# workdir             <- \"p:/1205711-edspa/2012waq/eco-scen4-run1-02/\"\n\nmodelversion        <- \"eco-scen4-run1-random-corr-spm-34_2\"; filename = paste(modelversion,\".his\",sep=\"\")\n# modelversion        <- \"eco-scen4-run1-04-y2\"; filename = paste(modelversion,\".his\",sep=\"\")\n\nlocmod              <- c(\"MOVING_pocketbox\", \"Huibertgat_oost\")\nsubmod              <- c(\"ExtVl\",\"Chlfa\", \"Salinity\")  #\"Salinity\",\n# submod              <- c(\"Salinity\", \"SS\")  #\"Salinity\",\n\nMOD.arr             <- read.his2(file.path(getwd(),filename))\nMOD.df              <- melt(MOD.arr[,locmod, submod], varnames=c(\"time\", \"location\", \"substance\"))\n    MOD.df          <- subset(MOD.df, MOD.df$value != -999 & MOD.df$location == \"MOVING_pocketbox\")\n    MOD.df$time      <-  as.POSIXct(\n      ifelse(is.na(as.POSIXct(MOD.df$time, format = \"%Y-%m-%d %H:%M:%S\")),\n             as.POSIXct(MOD.df$time, format = \"%Y-%m-%d\"),\n             as.POSIXct(MOD.df$time, format = \"%Y-%m-%d %H:%M:%S\")),\n      origin = \"1970-01-01 00:00:00\")\n\n    MOD.df <- MOD.df[with(MOD.df, order(time)), ]\n    dates <- format(MOD.df$time, format = \"%d%b\")\n    MOD.df$dates <- (dates)\n    MOD.df$substance<-as.factor(mapvalues(as.character(MOD.df$substance), c(\"Salinity\",\"SS\",\"DOC\",\"MDIATOMS\",\"MFLAGELA\",\"ExtVl\",\"Chlfa\",\"OXY\"),\n                                          c(\"Salinity\",\"SPM\",\"DOC\",\"Diatoms\",\"Flagellates\",\"Extinction\",\"Chlfa\",\"Oxygen\")))\n#     MOD.df$substance<- factor(MOD.df$substance, levels = c(\"Salinity\",\"SPM\",\"Extinction\",\"Chlfa\"))\n\n##=================== All data from project disk ===========================\nPBdat           <- read.csv2(file.path(datadir, \"Pocketbox2012_bewerkt_filtered.csv\"), dec = \".\", sep = \";\", header = T)\nPBdat$time      <- as.POSIXct(as.character(PBdat$datetime), format = \"%d-%m-%y %H:%M\", tz = \"CET\")\n# PBdat$time      <- as.POSIXct(PBdat$time)\nkeepdat         <- c(\"time\", \"Salinity\", \"Chlfa\", \"SPM\", \"Extinction\")       # \"Salinity\",\n# keepdat         <- c(\"time\", \"Salinity\", \"InorgSuspSol_Turbidity\")\nPBdat2          <- PBdat[keepdat]\nPBdat3          <- melt(PBdat2, variable.name =\"substance\", id.vars = c(\"time\"))\nPBdat3$dates <- format(PBdat3$time, format= \"%d%b\")\n\n##==================== only aggregated observations on model time scale ===================\n# PBdat <- read.delim(\"d:/GIS-DATA/Nederland/EemsDoll/IMARES/PocketboxLocations/MovingAsteriasObservations\")\n# PBdat$datetime = as.POSIXct((as.character(PBdat$Date))) + PBdat$hour*3600\n# #   as.POSIXct(PBdat$hour*3600, origin = \"2012/01/01 00:00:00\")\n# keepdat <- c(\"datetime\", \"meanChla\", \"meanSal\", \"meanTemp\")\n# PBdat2 <- PBdat[keepdat]\n##==========================================================================================\n\nlibrary(scales)\np <- ggplot(MOD.df, aes(time, value))\np +\n  geom_point(data = PBdat3, aes(x = time, y = value), color = \"royalblue1\",\n             shape = 16, size = 2, alpha = 0.3) +\n#   geom_smooth(data = PBdat3, aes(x = time, y = value), size = 1, color = \"royalblue4\", linetype = 5) +\n  geom_line(color = \"darkolivegreen4\", size = 1) +\n#   geom_point(color = \"darkolivegreen4\", fill = \"white\", size = 3, shape = 21) +\n  facet_grid(substance ~ dates, scales = \"free\")# +\n  scale_x_datetime(breaks = \"2 hours\", labels = date_format(\"%H\")) +\n  labs(title = modelversion,\n       x = \"time of day in hours (UTC)\",\n#       y = \"?g/l (Chlfa)                 /m (Extinction)              g/m3 (SPM)                PSU (Salinity)\") +\ny = \"              g/m3 (SPM)                PSU (Salinity)\") +\n  theme(text = element_text(size = 14))\n\n#======\np <- ggplot(PBdat3, aes(time, value))\np +\n  geom_point(color = \"royalblue1\",\n             shape = 16, size = 2, alpha = 0.3) +\n  #   geom_smooth(data = PBdat3, aes(x = time, y = value), size = 1, color = \"royalblue4\", linetype = 5) +\n    geom_line(data = MOD.df, aes(time,value), color = \"darkolivegreen4\", size = 1) +\n#     geom_point(data = MOD.df, aes(time,value), color = \"darkolivegreen4\", fill = \"white\", size = 3, shape = 21) +\n  facet_grid(substance ~ dates, scales = \"free\") +\nscale_x_datetime(breaks = \"2 hours\", labels = date_format(\"%H\")) +\n  labs(title = modelversion,\n       x = \"time of day in hours (UTC)\",\n       #       y = \"?g/l (Chlfa)                 /m (Extinction)              g/m3 (SPM)                PSU (Salinity)\") +\n       y = \"              g/m3 (SPM)                PSU (Salinity)\") +\n  theme(text = element_text(size = 14))\n\n\n\n# dev.off()\n# # dir.create(file.path(workdir, \"plots\"))\n#ggsave(file = file.path(getwd(), \"plots\", \"PocketBox-model-comparison(b)_2012.png\"),width=15,height=10,dpi=300)\nggsave(file = file.path(datadir, \"PocketBox-model-comparison(c)_2012.png\"),width=15,height=7,dpi=300)\n#\nstr(MOD.df)\n\n\n",
    "created" : 1424348043322.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2214790898",
    "id" : "CCB7BE75",
    "lastKnownWriteTime" : 1424348922,
    "path" : "D:/PROJECTS/SPA-KRW-Eems-Dollard/R-tools/Pocketbox-comparison_nieuwedata.R",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}