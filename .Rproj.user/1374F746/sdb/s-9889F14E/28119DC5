{
    "contents" : "##\n## Calculates sum of ULVA(benthic diatoms) types for 5 locations\n## locations as his output\n## Locations are as chosen to fit Imares sampling locations from map\n## However, hard to fit exactly.\n\nrequire(ggplot2)\n\nsetwd(\"D:/REPOS-CHECK-OUTS/OpenEarthTools/r/applications/Delft3D/waq\")\nlibrary(reshape2)\nlibrary(ggplot2)\nrequire(scales)\nrequire(plyr)\nsource(\"read.his2.R\")\n\n## model application version\nversion   <-  \"eco_2013-run1-29_y2_025\"\nmodfil    <-  paste(version, \".his\", sep = \"\")\nmoddir    <-  \"d:/Models/ED\"\n# moddir    <-  \"p:/1205711-edspa/2012waq/eco-scen4-run1-02/\"\n# filename  <-  file.path(moddir, modfil) # from network disk\nfilename  <-  file.path(\"d:/MODELS\", \"ED\", modfil)  ##local copy\nmapping   <- read.csv(\"d:/Tools_Scripts/Mapping tables/RWS2DELWAQ2names.csv\",\n                      , colClasses = \"character\")\nbeginsummer <- as.POSIXct(\"2012-06-01\")\nendsummer <- as.POSIXct(\"2012-09-30\")\n\narr <- read.his2(filename)\n\nlocmod1    =  c(\"EDB01area\",\"EDB03area\",\"EDB04area\", \"EDB05area\", \"EDB06area\")\n# locmod1    =  c(\"EDB01\",\"EDB03\",\"EDB04\", \"EDB05\", \"EDB06\")\nlocs      =  c(\"Station_1\",\"Station_3\",\"Station_4\", \"Station_5\", \"Station_6\")\n\nsubmod    = c(\"ULVAF_E\", \"ULVAF_N\", \"ULVAF_P\")\nunits     =  \"g/m2\"\n\ndf.temp               <-  melt(arr[, locmod1, submod], varnames = c(\"time\", \"Station\", \"substance\"))\ndf          <- dcast(df.temp,formula= time + Station ~ ., sum)\ncolnames(df) <- c(\"time\", \"Station\", \"ULVAF\")\ndf$datetime      <-  as.POSIXct(x = df$time)\nqplot(x = datetime, y = ULVAF, data = df )\n\n# df$week          <-  as.numeric(runmed(df$ULVAF, 7*24, endrule = \"median\"))\n\ndf$Station      <-  mapvalues(as.factor(df$Station),\n                               locmod1, locs)\ndf$Station      <-  factor(df$Station,levels = locs)\n# df$substance     <- mapvalues(df$substance, mapping$Delwaq, mapping$Delwaq_long_name)\n# df$substance     <-  factor(df$substance,levels = mapvalues(submod, mapping$Delwaq, mapping$Delwaq_long_name))\n\n# require(reshape2)\n# df.molten <- melt(datje2, id.vars = \"Day\", variable.name = \"Station\",\n#                value.name = \"g_C_m2\")\ndf$mg_CHLA_m2 <- df$ULVAF * 1.5000e-002 * 1000\n# df$mg_CHLA_m2_week  <- df$week * 1.25000e-002 * 1000\ndf$Day <-   as.numeric((df$datetime - df$datetime[1])/86400)\nqplot(x = Day, y = mg_CHLA_m2, data = df )\n\n\n### read observations\ndat<-read.table(\"d:/PROJECTS/SPA-KRW-Eems-Dollard/ModelInData/IMARES/benthic-pp-van_IMARES_2014_Mar/EDB_Chla_data_final.csv\",sep=\",\", skip = 1, header=T)\ndat$Date <- as.Date(dat$Date)\ndat$Station = as.factor(paste(\"Station_\", dat$Station, sep = \"\"))\n\nlimits <- aes(ymax = CHLA + CHLA_STD, ymin=CHLA - CHLA_STD)\nq <- ggplot(dat, aes(Station, CHLA))\nq + geom_line(aes(color = as.factor(Day)), size = 2) +\n  geom_errorbar(aes(ymax = CHLA + CHLA_STD, ymin=CHLA - CHLA_STD, color = as.factor(Date)), width=0.25)\n\nq <- ggplot(df, aes(Day, mg_CHLA_m2))\nq + geom_point(aes(color = as.factor(Station)))\n\nq <- ggplot(dat, aes(Day, CHLA))\nq + geom_point(aes(color = Station)) +\n  geom_errorbar(aes(ymax = CHLA + CHLA_STD, ymin=CHLA - CHLA_STD, color = Station), width=5) +\n  geom_line(data = df, aes(x = Day, y = mg_CHLA_m2, color = Station)) +\n   scale_y_continuous(limits = c(0,250))+\n  facet_grid(Station ~ .)\n\nggsave(file.path(paste(moddir, \"/plots\", sep = \"\"), paste(version,\"benthchlavalidation.png\", sep = \"\")), height = 6, width = 6, dpi = 300)\n\n\n\n\n",
    "created" : 1424433995535.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2336925548",
    "id" : "28119DC5",
    "lastKnownWriteTime" : 1424442489,
    "path" : "D:/PROJECTS/SPA-KRW-Eems-Dollard/R-tools/2013Validation_benthic_biomass-from-his.R",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}